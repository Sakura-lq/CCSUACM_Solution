```cpp
class Solution
{
public:
    static const int MAX_BIT = 15; 
    static const int MAX_NODE = 20000 * 15 + 5;

    int trie[MAX_NODE][2];
    int cnt[MAX_NODE];
    int count, root;

    void clear()
    {
        memset(trie, 0, sizeof(trie));
        memset(cnt, 0, sizeof(cnt));
        count = 1;
        root = 1;
    }

    void add(int num)
    {
        int p = root;
        for (int i = MAX_BIT - 1; i >= 0; i--)
        {
            int bit = (num >> i) & 1;
            if (!trie[p][bit])
            {
                trie[p][bit] = ++count;
            }
            p = trie[p][bit];
            cnt[p]++;
        }
    }

    int get(int num, int x)
    {
        int p = root;
        int res = 0;
        for (int i = MAX_BIT - 1; i >= 0; i--)
        {
            int r = (num >> i) & 1;
            int b = (x >> i) & 1;
            if (b)
            {
                if (trie[p][r])
                {
                    res += cnt[trie[p][r]];
                }
                p = trie[p][r ^ 1];
            }
            else
            {
                p = trie[p][r];
            }
        }
        if (p)
        {
            res += cnt[p];
        }
        return res;
    }

    int f(vector<int> &nums, int x)
    {
        clear();
        int res = 0;
        for (int i = 1; i < nums.size(); i++)
        {
            add(nums[i - 1]);
            res += get(nums[i], x);
        }
        return res;
    }

    int countPairs(vector<int> &nums, int low, int high)
    {
        return f(nums, high) - f(nums, low - 1);
    }
};
```

